name: Auto Download TikTok Video

on:
  push:  # Workflow berjalan otomatis setiap kali ada commit baru
  workflow_dispatch:  # Masih bisa dijalankan manual juga

jobs:
  download_and_commit_video:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y wget curl jq

    - name: Get actual TikTok Video URL
      run: |
        response=$(curl -sL "https://vm.tiktok.com/ZSMggXVNH/")
        video_url=$(echo "$response" | grep -oP 'video_url":"\K(.*?)(?=")')
        echo "Resolved Video URL: $video_url"
        if [ -z "$video_url" ]; then
          echo "Failed to extract video URL. Exiting."
          exit 1
        fi
        echo "video_url=$video_url" >> $GITHUB_ENV

    - name: Download TikTok Video
      run: |
        curl -L "$video_url" -o video.mp4
        if [ ! -f "video.mp4" ]; then
          echo "Video download failed."
          exit 1
        fi

    - name: Upload Video as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: tiktok-video
        path: video.mp4
      
